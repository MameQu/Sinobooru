<!DOCTYPE html>
<html>
<title>q2u-d</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <style>
    textarea {
      resize: none;
      overflow-y: hidden;
      height: auto;
    }
  </style>
<body>

<div class="w3-bar w3-black">
  <button class="w3-bar-item w3-button" onclick="Tabss('S1')">P1</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S2')">P2</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S3')">P3</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S4')">P4</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S5')">P5</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S6')">P6</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S7')">P7</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S8')">P8</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S9')">P9</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S10')">P10</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S11')">P11</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S12')">P12</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S13')">P13</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S14')">P14</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S15')">P15</button>
  <button class="w3-bar-item w3-button" onclick="Tabss('S16')">P16</button>
  <button class="w3-bar-item w3-button" onclick="Clear()" style="font-size: x-small;">><span id="show">0</span></button>
</div>

<div id="S1" class="w3-container city">
  <textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z1">
</textarea>
</div>

<div id="S2" class="w3-container city" style="display:none">
<textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z2" readonly></textarea>
</div>

<div id="S3" class="w3-container city" style="display:none">
<textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z3" readonly></textarea>
</div>

<div id="S4" class="w3-container city" style="display:none">
<textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z4" readonly></textarea>
</div>

<div id="S5" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z5" readonly></textarea></div>
<div id="S6" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z6" readonly></textarea></div>
<div id="S7" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z7" readonly></textarea></div>
<div id="S8" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z8" readonly></textarea></div>
<div id="S9" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z9" readonly></textarea></div>
<div id="S10" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z10" readonly></textarea></div>
<div id="S11" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z11" readonly></textarea></div>
<div id="S12" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z12" readonly></textarea></div>
<div id="S13" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z13" readonly></textarea></div>
<div id="S14" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z14" readonly></textarea></div>
<div id="S15" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z15" readonly></textarea></div>
<div id="S16" class="w3-container city" style="display:none"><textarea style="width:90%;margin: 8px 5%;height: 865px;font-size: 30px;" id="Z16" readonly></textarea></div>

<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
<script>
  var QTranslate = 1;
  var Zsaves = {
  Z1: true,
  Z2: true,
  Z3: true,
  Z4: true,
  Z5: true,
  Z6: true,
  Z7: true,
  Z8: true,
  Z9: true,
  Z10: true,
  Z11: true,
  Z12: true,
  Z13: true,
  Z14: true,
  Z15: true,
  Z16: true,
  WC: 0,
 };
  var i;
  var hero = "First";
  var x = document.getElementsByClassName("city");
function Tabss(Titles) {
  document.getElementsByTagName("button")[16].style.backgroundColor = '#000';
  hero = "First";
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";
    document.getElementsByTagName("button")[i].style.backgroundColor = '#000';
    document.getElementsByTagName("button")[i].style.color = '#fff';
  };
  document.getElementById(Titles).style.display = "block";  
  var t = Titles.substr(1, Titles.length - 1);
  document.getElementsByTagName("button")[t - 1].style.backgroundColor = '#fff';
    document.getElementsByTagName("button")[t - 1].style.color = '#000';
  if (document.getElementById("Z" + t).readOnly) {
       document.getElementById("Z" + t).removeAttribute('readonly');
  } else {
            document.getElementById("Z" + t).readOnly = "false";
  };
  Zsaves.Z1 = document.getElementById("Z1").value;
  Zsaves.Z2 = document.getElementById("Z2").value;
  Zsaves.Z3 = document.getElementById("Z3").value;
  Zsaves.Z4 = document.getElementById("Z4").value;
  Zsaves.Z5 = document.getElementById("Z5").value;
  Zsaves.Z6 = document.getElementById("Z6").value;
  Zsaves.Z7 = document.getElementById("Z7").value;
  Zsaves.Z8 = document.getElementById("Z8").value;
  Zsaves.Z9 = document.getElementById("Z9").value;
  Zsaves.Z10 = document.getElementById("Z10").value;
  Zsaves.Z11 = document.getElementById("Z11").value;
  Zsaves.Z12 = document.getElementById("Z12").value;
  Zsaves.Z13 = document.getElementById("Z13").value;
  Zsaves.Z14 = document.getElementById("Z14").value;
  Zsaves.Z15 = document.getElementById("Z15").value;
  Zsaves.Z16 = document.getElementById("Z16").value;
savefile.save();
g = t - 1;
   var v = document.getElementsByTagName("textarea")[g];
            let res = [];
            let str = v.value.replace(/[\t\n\r\.\?\!]/gm, " ").split(" ");
            str.map((s) => {
              let trimStr = s.trim();
              if (trimStr.length > 0) {
                res.push(trimStr);
              };
            document.querySelector("#show").innerText = res.length;
            });
            
  document.getElementsByTagName("button")[16].style.color = '#fff';
  initCount();
};
function Clear() {
if (hero == "First") {
  document.getElementsByTagName("button")[16].style.backgroundColor = '#fff';
  document.getElementsByTagName("button")[16].style.color = '#000';
  hero = "Second";
} else if (hero == "Second") {
  hero = "Third";
} else {
  hero = "First";
  document.getElementsByTagName("button")[16].style.backgroundColor = '#000';
  document.getElementsByTagName("button")[16].style.color = '#fff';
for (i = 0; i < x.length; i++) {
    document.querySelector("#show").innerText = 0;
};
Zsaves.Z1 = "";document.getElementById("Z1").value = "";
Zsaves.Z2 = "";document.getElementById("Z2").value = "";
Zsaves.Z3 = "";document.getElementById("Z3").value = "";
Zsaves.Z4 = "";document.getElementById("Z4").value = "";
Zsaves.Z5 = "";document.getElementById("Z5").value = "";
Zsaves.Z6 = "";document.getElementById("Z6").value = "";
Zsaves.Z7 = "";document.getElementById("Z7").value = "";
Zsaves.Z8 = "";document.getElementById("Z8").value = "";
Zsaves.Z9 = "";document.getElementById("Z9").value = "";
Zsaves.Z10 =  "";document.getElementById("Z10").value = "";
Zsaves.Z11 =  "";document.getElementById("Z11").value = "";
Zsaves.Z12 =  "";document.getElementById("Z12").value = "";
Zsaves.Z13 =  "";document.getElementById("Z13").value = "";
Zsaves.Z14 =  "";document.getElementById("Z14").value = "";
Zsaves.Z15 =  "";document.getElementById("Z15").value = "";
Zsaves.Z16 =  "";document.getElementById("Z16").value = "";
savefile.save();
};
};

var init = function() {
savefile.restore();
g = 0;
document.querySelector("#Z1").value = Zsaves.Z1;
document.querySelector("#Z2").value = Zsaves.Z2;
document.querySelector("#Z3").value = Zsaves.Z3;
document.querySelector("#Z4").value = Zsaves.Z4;
document.querySelector("#Z5").value = Zsaves.Z5;
document.querySelector("#Z6").value = Zsaves.Z6;
document.querySelector("#Z7").value = Zsaves.Z7;
document.querySelector("#Z8").value = Zsaves.Z8;
document.querySelector("#Z9").value = Zsaves.Z9;
document.querySelector("#Z10").value = Zsaves.Z10;
document.querySelector("#Z11").value = Zsaves.Z11;
document.querySelector("#Z12").value = Zsaves.Z12;
document.querySelector("#Z13").value = Zsaves.Z13;
document.querySelector("#Z14").value = Zsaves.Z14;
document.querySelector("#Z15").value = Zsaves.Z15;
document.querySelector("#Z16").value = Zsaves.Z16;
  document.getElementsByTagName("button")[0].style.backgroundColor = '#fff';
    document.getElementsByTagName("button")[0].style.color = '#000';
   var v = document.getElementsByTagName("textarea")[0];
            let res = [];
            let str = v.value.replace(/[\t\n\r\.\?\!]/gm, " ").split(" ");
            str.map((s) => {
              let trimStr = s.trim();
              if (trimStr.length > 0) {
                res.push(trimStr);
              };
            document.querySelector("#show").innerText = res.length;
            });
initCount();
};
var initlv2 = function() {
savefile.save();
};
function resizeTextarea() {
  $('textarea').each(function() {
    this.style.height = 'auto';
    this.style.height = Math.max(300, this.scrollHeight) + 'px';
  });
};

  var savefile = {
  save: function() {
    var settingfile = {
    Z1: Zsaves.Z1,
    Z2: Zsaves.Z2, 
    Z3: Zsaves.Z3,
    Z4: Zsaves.Z4,
    Z5: Zsaves.Z5,
    Z6: Zsaves.Z6,
    Z7: Zsaves.Z7, 
    Z8: Zsaves.Z8,
    Z9: Zsaves.Z9,
    Z10: Zsaves.Z10,
    Z11: Zsaves.Z11,
    Z12: Zsaves.Z12, 
    Z13: Zsaves.Z13,
    Z14: Zsaves.Z14,
    Z15: Zsaves.Z15,
    Z16: Zsaves.Z16,
    WC: Zsaves.WC
    };
  var settingval = JSON.stringify(settingfile);
  localStorage["TheDraft"] = settingval;
},
  restore: function() {
    var loadfile = localStorage["TheDraft"];
    if (!loadfile) {
      console.log("I am save");
      savefile.save();
      initlv2();
      return;
    }
    console.log("No. I am save");
    var settingval = JSON.parse(loadfile);
    $.extend(Zsaves, settingval);
    initlv2();
  }
};

var initCount = function() {
   document.getElementsByTagName("textarea")[g]
          .addEventListener("input", function countWord() {
            let res = [];
            let str = this.value.replace(/[\t\n\r\.\?\!]/gm, " ").split(" ");
            str.map((s) => {
              let trimStr = s.trim();
              if (trimStr.length > 0) {
                res.push(trimStr);
              }
            });
            document.querySelector("#show").innerText = res.length;
            Zsaves.WC = res.length;
            savefile.save();
          });
          savefile.save();
          resizeTextarea();
};

hotkeys('ctrl+s,ctrl+d,s,d', function (event, handler){
  switch (handler.key) {
    case 'ctrl+s': event.preventDefault();save();
      break;
    case 'ctrl+d': event.preventDefault();open();
      break;
    case 's': event.preventDefault();
    resizeTextarea();
      break;
    case 'd': event.preventDefault();
    for (i = 0; i < x.length; i++) {
    document.getElementById("Z" + (i + 1)).readOnly = "false";
    console.log(i + 1);};
      break;
  }
});

let fileHandle;
const open = async () => {
  [fileHandle] = await window.showOpenFilePicker()
  const file = await fileHandle.getFile()
  const contents = await file.text()
  var settingval = JSON.parse(contents);
  $.extend(Zsaves, settingval);
document.querySelector("#Z1").value = Zsaves.Z1;
document.querySelector("#Z2").value = Zsaves.Z2;
document.querySelector("#Z3").value = Zsaves.Z3;
document.querySelector("#Z4").value = Zsaves.Z4;
document.querySelector("#Z5").value = Zsaves.Z5;
document.querySelector("#Z6").value = Zsaves.Z6;
document.querySelector("#Z7").value = Zsaves.Z7;
document.querySelector("#Z8").value = Zsaves.Z8;
document.querySelector("#Z9").value = Zsaves.Z9;
document.querySelector("#Z10").value = Zsaves.Z10;
document.querySelector("#Z11").value = Zsaves.Z11;
document.querySelector("#Z12").value = Zsaves.Z12;
document.querySelector("#Z13").value = Zsaves.Z13;
document.querySelector("#Z14").value = Zsaves.Z14;
document.querySelector("#Z15").value = Zsaves.Z15;
document.querySelector("#Z16").value = Zsaves.Z16;
}


const save = async content => {
  try {
    var settingfile = {
    Z1: Zsaves.Z1,
    Z2: Zsaves.Z2, 
    Z3: Zsaves.Z3,
    Z4: Zsaves.Z4,
    Z5: Zsaves.Z5,
    Z6: Zsaves.Z6,
    Z7: Zsaves.Z7, 
    Z8: Zsaves.Z8,
    Z9: Zsaves.Z9,
    Z10: Zsaves.Z10,
    Z11: Zsaves.Z11,
    Z12: Zsaves.Z12, 
    Z13: Zsaves.Z13,
    Z14: Zsaves.Z14,
    Z15: Zsaves.Z15,
    Z16: Zsaves.Z16,
    WC: Zsaves.WC
    }
    const handle = await window.showSaveFilePicker()
    var writable = await handle.createWritable()
    await writable.write(JSON.stringify(settingfile))
    await writable.close()
    return handle
  } catch (err) {
    console.error(err.name)
  }
};

setInterval(function() {
  savefile.save();
  console.log("Autosaved.");
}, 30000);

 var starcast = setInterval(function(){
    if (QTranslate){
      clearInterval(starcast);
      starcast = null;
     init();
    } else {
      console.log("not ready");
    }
  } ,100)

</script>

</body>